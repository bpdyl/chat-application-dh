
<!DOCTYPE html>
{% load static %}
<html lang="en" dir="ltr">
  <head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="{% static 'css/sidebar.css' %}">
    <link rel="stylesheet" href="{% static 'css/searchuser.css' %}"></style>
    <link href='https://unpkg.com/boxicons@2.0.7/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script
    src="https://code.jquery.com/jquery-3.6.0.min.js"
    integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
    crossorigin="anonymous">
</script>
     <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>

.user_profile{
  align-items: center;
  display: block;
  text-align: center;
  padding-top: 1em;

}
.user_profile img{
  height: 120px;
  width: 120px;
  border-radius: 50%;
}
.fixedbar{
  background: inherit;
  left: 0;
  top: 0;
  width: inherit;
  padding: inherit;
  position: fixed;
  z-index: 1;
}
.next-div{
  position: relative;
  clear: both;
  margin-top: 115px;
}

  </style>
   </head>
<body>
  
  {{ private_thread_json |json_script:"private_thread" }}
  {{ current_user |json_script:"logged_in_user"}}
  {{ my_user |json_script:"my_user_json" }}
  <div class="modal left fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		<div class="modal-dialog" role="document">
			<div class="modal-content">

				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h4 class="modal-title" id="myModalLabel">Left Sidebar</h4>
				</div>

				<div class="modal-body">
				<div class="modal-list">
                <a href="{% url 'accounts:profile' userId=request.user.id %}"><li>My profile</li></a>
          <li>Friends</li>
          <a href="{% url 'logout' %}"><li>Logout</li></a>
        </div>
				</div>

			</div><!-- modal-content -->
		</div><!-- modal-dialog -->
	</div><!-- modal -->


  <!-- Client Error MODAL -->
<button type="button" id="id_trigger_client_error_modal" class="d-none btn btn-primary" data-toggle="modal" data-target="#id_client_error_modal">
</button>
<div class="modal fade" id="id_client_error_modal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Socket Client Error</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p id="id_client_error_modal_body">Something went wrong.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal" id="id_client_error_modal_close_btn">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- Client Error MODAL -->



  <div class="sidebar open" id="sideBar">
    <div class="fixedbar">
    <form id="searchbar" autocomplete="off" onkeydown="return event.key != 'Enter';">
        {% csrf_token %}
      <li>
      <i class="bx bx-search"></i>
      <input type="text" id="search-input" placeholder="Search..."></input>
      <span class="tooltip">Search</span>
      </li>
    </form>
    <div id="results-box" class="results-card not-visible">
        hello
    </div>
    <div class="logo-details">
      <i class='bx bxl-c-plus-plus icon'></i>
        <div class="logo_name">ChitChat</div>
        
    <i class="bx bx-menu" id="btn" data-toggle="modal" data-target="#myModal"></i>

    </div>
  </div>
  
   <div class="next-div" id="contact-list" >
    <ul class="nav-list" id="contact_list_ul">
      {% for x in message_and_friends %}
     <li style="cursor: pointer;">
       <a onclick="onSelectFriend('{{x.friend.id}}',this);" class="myclass" data-userId="{{x.friend.id}}" id="id_friend_list_{{x.friend.id}}">
         <!-- <i class='bx bx-chat' ></i> -->
        <div class="col-lg-4">
         <img id="id_friend_img_{{x.friend.id}}" src="{{x.friend.profile_image.url}}" class="contacts-image" style="height:70px; width: 70px; border-radius: 50%;" alt="" srcset="">
        </div>
         <span class="links_name">{{x.friend.first_name}} {{x.friend.last_name}}
            <p style="color: black;font-size: small;">You: hi there</p>
         </span>

       </a>
       <span class="tooltip">Messages</span>
       <button class="button-17" role="button"><b>&hellip;</b></span></button>
     </li>
     {% endfor %}
     <li>
          <i class='bx bx-search' ></i>
         <input type="text" placeholder="Search...">
         <span class="tooltip">Search</span>
      </li>
      <li  style="cursor: pointer;">
       <a onclick="console.log('check me')">
         <i class='bx bx-cog' ></i>
         <span class="links_name">Setting</span>
         <span style="color:rgb(0, 0, 0);margin-top:35px;margin-left: -55px;">You: Hi there</span>

       </a>
       <span class="tooltip">Setting</span>
     </li>
     <li class="profile">
         <div class="profile-details">
           <img src="profile.jpg" alt="profileImg">
           <div class="name_job">
             <div class="name">Bibek Paudyal</div>
             <div class="job">Noob</div>
           </div>
         </div>
         <i class='bx bx-log-out' id="log_out" ></i>
     </li>
    </ul>
  </div>
  </div>



  <section class="home-section" id="home_section">
    <div class="chat-header">
        <div class="header-image">

            <h5>{{ user.get_username }}</h5>
        </div>
    </div>
    <div class="messages" id="chat_section">

        <ul id="message_history">
          <li class="sent">
            <img src="http://emilcarlsson.se/assets/mikeross.png" alt="" />
					<p>How the hell am I supposed to get a jury to believe you when I am not even sure that I do?!</p>
          </li>

          <li class="replies">
            <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
            <p>When you're backed against the wall, break the god damn thing down.</p>
          </li>
          <li class="replies">
            <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
            <p>Excuses don't win championships.</p>
          </li>
          <li class="sent">
            <img src="http://emilcarlsson.se/assets/mikeross.png" alt="" />
            <p>Oh yeah, did Michael Jordan tell you that?</p>
          </li>
          <li class="sent">
            <img src="http://emilcarlsson.se/assets/mikeross.png" alt="" />
					<p>How the hell am I supposed to get a jury to believe you when I am not even sure that I do?!</p>
          </li>

          <li class="replies">
            <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
            <p>When you're backed against the wall, break the god damn thing down.</p>
          </li>
          <li class="replies">
            <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
            <p>Excuses don't win championships.</p>
          </li>
          <li class="sent">
            <img src="http://emilcarlsson.se/assets/mikeross.png" alt="" />
            <p>Oh yeah, did Michael Jordan tell you that?</p>
          </li>
          <li class="sent">
            <img src="http://emilcarlsson.se/assets/mikeross.png" alt="" />
					<p>How the hell am I supposed to get a jury to believe you when I am not even sure that I do?!</p>
          </li>

          <li class="replies">
            <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
            <p>When you're backed against the wall, break the god damn thing down.</p>
          </li>
          <li class="replies">
            <img src="http://emilcarlsson.se/assets/harveyspecter.png" alt="" />
            <p>Excuses don't win championships.</p>
          </li>
          <li class="sent">
            <img src="http://emilcarlsson.se/assets/mikeross.png" alt="" />
            <p>Oh yeah, did Michael Jordan tell you that?</p>
          </li>

        </ul>
    </div>
    <span class="" id="page_number_id">1</span>
      <div class="message-input">
        
        
        {% csrf_token %}
        <i class="bx bx-paperclip" style="color: white; font-size: 23px;margin: 0.5em;cursor: pointer;"><input id="fileupload" type="file" name="file" multiple
          style="display: none;"
          
          data-form-data='{"csrfmiddlewaretoken": "{{ csrf_token }}"}'></i>

          <textarea placeholder="Write your message..." id="chat_message_input" ></textarea>
          
      </div>
  </section>
  <section class="media-section">
    <div class="user_profile">
      <a style="text-decoration: none;cursor: pointer;color: white;" id="other_user_info">
      <img src="{% static 'images/nouser.jpg' %}" id="other_user_profile_image"  alt="" srcset="">
      <h4 class="ml-2" id="id_other_username">Bibek Paudyal</h4>
    </a>
    </div>
  </section>
  <script>
  let sidebar = document.querySelector(".sidebar");
  let closeBtn = document.querySelector("#btn");
  let searchBtn = document.querySelector(".bx-search");

  // closeBtn.addEventListener("click", ()=>{
  //   sidebar.classList.toggle("open");
  //   menuBtnChange();//calling the function(optional)
  // });

  searchBtn.addEventListener("click", ()=>{ // Sidebar open when you click on the search iocn
    var cwidth = document.body.clientWidth;
    if(sidebar.classList.contains('open') && cwidth > 820){
      
    }else{
      sidebar.classList.toggle("open");
    }
    alterClass(); //calling the function(optional)
  });

  // following are the code to change sidebar button(optional)
  // function menuBtnChange() {
  //  if(sidebar.classList.contains("open")){
  //    closeBtn.classList.replace("bx-menu", "bx-menu-alt-right");//replacing the iocns class
  //  }else {
  //    closeBtn.classList.replace("bx-menu-alt-right","bx-menu");//replacing the iocns class
  //  }
  // }
    $(document).ready(function($) {
  var alterClass = function() {
    var ww = document.body.clientWidth;
    console.log("this is ww"+ww);
    if (ww < 820) {
      $('.sidebar').removeClass('open');
      $('.button-17').css('display','none');
      $('.media-section').addClass('close');
      $('.home-section').css('overflow-x','hidden');

    } else if (ww >= 821) {
      $('.sidebar').addClass('open');
      $('.media-section').removeClass('close');
      $('.home-section').css('width','');
    };
  };
  $(window).resize(function(){
    alterClass();
  });
  //Fire it when the page first loads:
  alterClass();
});
  </script>
  <script src="{% static 'utilityjs/base.js' %}"></script>

  <script async="async" defer="defer" src="{% static 'utilityjs/privatechat.js' %}" 
  {% if user.is_authenticated %} data-authenticated="true" {% endif %}>
</script>
  <script type="text/javascript">
    onStart()
    function getIDs() {
  var lis = document.getElementById("contact_list_ul").getElementsByTagName("a");
  for (li of lis) {
    console.log(li.getAttribute("data-userid")); // paints id
    return li.getAttribute('data-userid');
    break;
  }
}
function onStart(){
  
  {% if private_thread %}
  console.log("cha raicha thread ta")
    if("{{private_thread.first_user}}" == "{{request.user}}"){
      onSelectFriend("{{private_thread.second_user.id}}")
    }
    else{
      onSelectFriend("{{private_thread.first_user.id}}",this)
    }
  {% else %}
  console.log("khuchhing")
    {% if message_and_friends %}
      onSelectFriend("{{message_and_friends.0.friend.id}}",this)
    {% endif %}
  {% endif %}
  {% for x in message_and_friends %}
    console.log("image preloading")
    preloadImage("{{x.friend.profile_image.url|safe}}", "id_friend_img_{{x.friend.id}}")
  {% endfor %}
}
  </script>
  
  <script>

var removeActiveThreadFriend = ()=>{
    {% if message_and_friends %}
			{% for x in message_and_friends %}
				document.getElementById("id_friend_list_{{x.friend.id}}").classList.remove('active-contact');
			{% endfor %}
		{% endif %}

		// clear the profile image and username of current chat
		document.getElementById("other_user_profile_image").classList.add("d-none")
		document.getElementById("other_user_profile_image").src = "{% static 'images/nouser.jpg' %}"
		document.getElementById("id_other_username").innerHTML = ""
}
  </script>
  <script src="{% static 'utilityjs/searchuser.js' %}"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
</body>
</html>